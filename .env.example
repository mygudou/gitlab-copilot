# =============================================================================
# GitLab AI Copilot 环境变量配置
# =============================================================================
# 支持变量替换: ${VAR} 或 $VAR 语法
# 
# 快速开始:
# 1. 复制此文件为 .env
# 2. 根据你的环境修改配置值
# 3. 启动服务: npm run dev
# =============================================================================

# -----------------------------------------------------------------------------
# AI 配置
# -----------------------------------------------------------------------------

# AI 执行器选择 (默认 AI 提供商)
# - claude: 使用 Anthropic Claude
# - codex: 使用 OpenAI Codex
# 用于 Issue 对话、代码修改等常规任务
# 用户可通过 @claude 或 @codex 在每次请求时覆盖此默认值
AI_EXECUTOR=claude

# 代码审查默认 AI
# 专门用于 MR 自动代码审查的默认 AI 提供商
# 可选值: claude 或 codex
# 同样可通过 @claude 或 @codex 覆盖
CODE_REVIEW_EXECUTOR=codex

# Claude API 配置
ANTHROPIC_BASE_URL=https://api.anthropic.com
# 从 https://console.anthropic.com/ 获取
ANTHROPIC_AUTH_TOKEN=sk-ant-your-anthropic-api-key-here

# -----------------------------------------------------------------------------
# GitLab 配置 (传统单用户模式 - 仅在未配置多租户时使用)
# -----------------------------------------------------------------------------
# 注意: 如果启用了多租户模式 (配置了 MONGODB_URI)，
#       以下 GITLAB_TOKEN 和 WEBHOOK_SECRET 将作为兜底凭证使用
#       建议通过 Web UI 或 API 为每个租户单独配置 GitLab 凭证

# GitLab 实例地址
GITLAB_BASE_URL=https://gitlab.com

# GitLab Personal Access Token (传统单用户模式专用)
# 需要的权限: api, read_repository, write_repository
# 多租户模式下，每个用户通过 Web UI 配置自己的 token
# GITLAB_TOKEN=glpat-your-gitlab-personal-access-token

# Webhook 验证密钥 (传统单用户模式专用)
# 多租户模式下，每个用户配置自动生成独立的 webhook secret
# WEBHOOK_SECRET=your-random-webhook-secret-string

# -----------------------------------------------------------------------------
# 服务配置
# -----------------------------------------------------------------------------

# HTTP 服务端口
PORT=3000

# 工作目录 (用于存储临时文件、工作区、Session 等)
WORK_DIR=/tmp/gitlab-copilot-work

# 日志级别 (error, warn, info, debug)
LOG_LEVEL=info

# -----------------------------------------------------------------------------
# 多租户平台模式配置 (可选)
# -----------------------------------------------------------------------------
# 如果要启用多租户模式，需要配置 MongoDB 和加密密钥

# MongoDB 连接字符串
# 示例: mongodb://username:password@host:27017/?authSource=admin
MONGODB_URI=

# MongoDB 数据库名称
MONGODB_DB=gitlab-copilot

# 数据加密密钥 (32 字节十六进制字符串)
# 生成方法: openssl rand -hex 32
ENCRYPTION_KEY=

# -----------------------------------------------------------------------------
# Session 管理配置
# -----------------------------------------------------------------------------

# 是否启用 Session (长交互模式)
SESSION_ENABLED=true

# Session 最大空闲时间 (支持: 7d, 24h, 60m, 3600s)
SESSION_MAX_IDLE_TIME=7d

# 最大 Session 数量
SESSION_MAX_SESSIONS=1000

# Session 清理间隔 (不要超过 24.8 天，受 Node.js 限制)
SESSION_CLEANUP_INTERVAL=1h

# Session 存储路径
SESSION_STORE_PATH=/tmp/gitlab-copilot-work/sessions.json

# -----------------------------------------------------------------------------
# 工作区管理配置
# -----------------------------------------------------------------------------

# 工作区最大空闲时间
WORKSPACE_MAX_IDLE_TIME=24h

# 工作区清理间隔
WORKSPACE_CLEANUP_INTERVAL=6h

# -----------------------------------------------------------------------------
# Web UI 配置 (多租户模式)
# -----------------------------------------------------------------------------

# 是否启用 Web 管理界面
WEB_UI_ENABLED=true

# Web UI 基础路径
WEB_UI_BASE_PATH=/auth

# CORS 允许的源 (多个用逗号分隔)
CORS_ORIGINS=http://localhost:3000,https://your-domain.com

# -----------------------------------------------------------------------------
# JWT 认证配置 (Web UI 使用)
# -----------------------------------------------------------------------------

# JWT 密钥 (至少 32 字符的随机字符串)
# 生成方法: openssl rand -base64 32
JWT_SECRET=your-jwt-secret-key-at-least-32-characters-long

# Access Token 有效期 (建议: 15m-1h)
JWT_ACCESS_EXPIRES_IN=15m

# Refresh Token 有效期 (建议: 7d-30d)
JWT_REFRESH_EXPIRES_IN=7d

# -----------------------------------------------------------------------------
# 安全配置
# -----------------------------------------------------------------------------

# 密码加密强度 (10-14, 数字越大越安全但越慢)
BCRYPT_ROUNDS=12

# 最大登录失败次数
MAX_LOGIN_ATTEMPTS=5

# 锁定时长 (分钟)
LOCKOUT_DURATION=15

# Session 超时时间
SESSION_TIMEOUT=30m

# Cookie 安全设置 (生产环境建议为 true)
COOKIE_SECURE=false

# Cookie SameSite 策略 (strict, lax, none)
COOKIE_SAME_SITE=lax

# 是否信任代理 (如果在反向代理后面，设为 true)
TRUST_PROXY=false

# -----------------------------------------------------------------------------
# 速率限制配置
# -----------------------------------------------------------------------------

# 时间窗口 (毫秒)
RATE_LIMIT_WINDOW_MS=900000

# 最大请求数
RATE_LIMIT_MAX_REQUESTS=30

# 是否跳过成功请求的计数
RATE_LIMIT_SKIP_SUCCESSFUL_REQUESTS=true

# =============================================================================
# 生产环境建议
# =============================================================================
# 
# 1. 安全设置:
#    - COOKIE_SECURE=true
#    - COOKIE_SAME_SITE=strict
#    - TRUST_PROXY=true (如果使用反向代理)
#    - JWT_ACCESS_EXPIRES_IN=15m (更短的有效期)
# 
# 2. 日志配置:
#    - LOG_LEVEL=warn (减少日志量)
# 
# 3. Session 配置:
#    - SESSION_MAX_IDLE_TIME=3d (更短的空闲时间)
#    - SESSION_CLEANUP_INTERVAL=1h (更频繁的清理)
# 
# 4. 定期轮换密钥:
#    - JWT_SECRET
#    - ENCRYPTION_KEY
#    - WEBHOOK_SECRET
# 
# =============================================================================
