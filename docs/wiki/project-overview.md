# GitLab AI Copilot é¡¹ç›®æ¦‚è¿°

## ğŸ¯ ä¸šåŠ¡ç›®æ ‡

GitLab AI Copilot æ˜¯ä¸€ä¸ª**ä¼ä¸šçº§çš„ AI é©±åŠ¨å¼€å‘åä½œå¹³å°**ï¼Œé€šè¿‡ GitLab Webhook å°†å¤šç§ AI ä»£ç åŠ©æ‰‹(Claudeã€Codex ç­‰)æ·±åº¦é›†æˆåˆ° GitLab å·¥ä½œæµä¸­ã€‚

**æ ¸å¿ƒä»·å€¼ä¸»å¼ ï¼š**
- **é›¶ä¸Šä¸‹æ–‡åˆ‡æ¢**ï¼šç›´æ¥åœ¨ Issue/MR ä¸­ä¸ AI å¯¹è¯ï¼Œæ— éœ€ç¦»å¼€ GitLab
- **å›¢é˜Ÿå¯è§æ€§**ï¼šAI çš„å·¥ä½œè¿‡ç¨‹å’Œç»“æœå¯¹æ•´ä¸ªå›¢é˜Ÿé€æ˜å¯è¿½æº¯
- **è‡ªåŠ¨åŒ–å·¥ä½œæµ**ï¼šAI è‡ªåŠ¨åˆ›å»ºåˆ†æ”¯ã€æäº¤ä»£ç ã€ç”Ÿæˆ MR
- **æŒç»­å¯¹è¯èƒ½åŠ›**ï¼šAI è®°ä½ä¸Šä¸‹æ–‡ï¼Œæ”¯æŒå¤šè½®äº¤äº’å¼å¼€å‘

## ğŸ—ï¸ ç³»ç»Ÿè¾¹ç•Œ

### æ ¸å¿ƒåŠŸèƒ½èŒƒå›´
- **æ™ºèƒ½ Issue å¤„ç†**ï¼šåŒæ¨¡å¼ Issue å¤„ç†ç³»ç»Ÿï¼ˆä»£ç å¼€å‘æ¨¡å¼ + æ–‡æ¡£è§„èŒƒæ¨¡å¼ï¼‰
- **é›¶é…ç½®ä»£ç å®¡æŸ¥**ï¼šAI è‡ªåŠ¨å®¡æŸ¥æ¯ä¸ª MR
- **MR å†…ç›´æ¥ä¿®å¤**ï¼šè¯„è®ºå³æŒ‡ä»¤ï¼Œä»£ç å³æ›´æ–°
- **å¤š AI ååŒ**ï¼šæ”¯æŒ Claudeã€Codex ç­‰å¤šç§ AI æ¨¡å‹
- **ä¼ä¸šçº§å¤šç§Ÿæˆ·**ï¼šæ”¯æŒç»„ç»‡çº§éƒ¨ç½²ï¼Œæ•°æ®å®Œå…¨éš”ç¦»

### å¤–éƒ¨é›†æˆè¾¹ç•Œ
- **GitLab API**ï¼šé€šè¿‡ GitLab REST API ä¸ GitLab å®ä¾‹äº¤äº’
- **AI CLI å·¥å…·**ï¼šé›†æˆ Claude Code CLI å’Œ Codex CLI
- **Web ç®¡ç†ç•Œé¢**ï¼šå¯è§†åŒ–é…ç½®ç®¡ç†

## ğŸ›ï¸ æ ¸å¿ƒæ¨¡å—æ¶æ„

### 1. äº‹ä»¶å¤„ç†å±‚ (Event Processing Layer)
**èŒè´£**ï¼šæ¥æ”¶å’Œå¤„ç† GitLab Webhook äº‹ä»¶ï¼Œä½œä¸ºä¸­å¤®åè°ƒå™¨

**å…³é”®æ–‡ä»¶ï¼š**
- `src/services/eventProcessor.ts` - ä¸­å¤®äº‹ä»¶å¤„ç†å™¨
- `src/server/webhookServer.ts` - Webhook æœåŠ¡å™¨

### 2. ä¼šè¯ç®¡ç†å±‚ (Session Management Layer)
**èŒè´£**ï¼šç®¡ç†é•¿äº¤äº’ä¼šè¯å’Œä¸Šä¸‹æ–‡ï¼Œæ”¯æŒå¤šè½®å¯¹è¯

**å…³é”®æ–‡ä»¶ï¼š**
- `src/services/sessionManager.ts` - ä¼šè¯ç®¡ç†å™¨
- `src/services/workspaceCleanupService.ts` - å·¥ä½œåŒºæ¸…ç†æœåŠ¡

### 3. AI æ‰§è¡Œå±‚ (AI Execution Layer)
**èŒè´£**ï¼šæ‰§è¡Œ AI CLI å·¥å…·ï¼Œæä¾›æµå¼æ›´æ–°

**å…³é”®æ–‡ä»¶ï¼š**
- `src/services/streamingAiExecutor.ts` - æµå¼ AI æ‰§è¡Œå™¨
- `src/services/aiExecutor.ts` - AI æ‰§è¡Œå™¨

### 4. é¡¹ç›®ç®¡ç†å±‚ (Project Management Layer)
**èŒè´£**ï¼šå¤„ç† Git æ“ä½œå’Œåˆ†æ”¯ç®¡ç†

**å…³é”®æ–‡ä»¶ï¼š**
- `src/services/projectManager.ts` - é¡¹ç›®ç®¡ç†å™¨

### 5. æ•°æ®å­˜å‚¨å±‚ (Data Storage Layer)
**èŒè´£**ï¼šæä¾›æ•°æ®æŒä¹…åŒ–èƒ½åŠ›

**å…³é”®æ–‡ä»¶ï¼š**
- `src/services/storage/` - å­˜å‚¨ç›¸å…³æ¨¡å—

## ğŸ”„ å…³é”®æ•°æ®/æ§åˆ¶æµ

### Webhook äº‹ä»¶å¤„ç†æµç¨‹
```
GitLab Webhook â†’ Webhook Server â†’ Event Processor â†’ Session Manager â†’ AI Executor â†’ Project Manager â†’ GitLab API
```

### æ ¸å¿ƒæ•°æ®æµ
1. **äº‹ä»¶æ¥æ”¶**ï¼š`src/server/webhookServer.ts` æ¥æ”¶ GitLab äº‹ä»¶
2. **æŒ‡ä»¤æå–**ï¼šä»äº‹ä»¶å†…å®¹ä¸­æå– AI æŒ‡ä»¤
- `@claude` - ä½¿ç”¨ Claude AI æ¨¡å‹
- `@codex` - ä½¿ç”¨ Codex AI æ¨¡å‹
- **ä¼šè¯ç®¡ç†**ï¼šæ ¹æ®äº‹ä»¶ç±»å‹å†³å®šæ˜¯å¦ä½¿ç”¨ä¼šè¯æ¨¡å¼

## ğŸš€ éƒ¨ç½²/è¿è¡Œç¯å¢ƒ

### å¼€å‘ç¯å¢ƒ
- **Node.js** >= 16.0.0
- **npm** æˆ– yarn
- **Git**
- **MongoDB** (å¤šç§Ÿæˆ·æ¨¡å¼)
- **AI CLI å·¥å…·** (Claude Code CLI æˆ– Codex CLI)

### ç”Ÿäº§ç¯å¢ƒ
- **Docker éƒ¨ç½²**ï¼šå®Œæ•´çš„å®¹å™¨åŒ–éƒ¨ç½²æ–¹æ¡ˆ
- **Kubernetes æ”¯æŒ**ï¼šä¼ä¸šçº§é›†ç¾¤éƒ¨ç½²

### å®¹å™¨åŒ–æ¶æ„
- **Docker Compose**ï¼šæœ¬åœ°å¼€å‘ç¯å¢ƒ
- **PM2 è¿›ç¨‹ç®¡ç†**ï¼šç”Ÿäº§ç¯å¢ƒæ¨è
- **å¤šå®ä¾‹è´Ÿè½½å‡è¡¡**ï¼šé«˜å¯ç”¨æ€§æ¶æ„

## ğŸ¨ ç³»ç»Ÿç»„æˆ

### å‰ç«¯ (Frontend)
**ä½ç½®**ï¼š`public/` ç›®å½•
- `public/index.html` - ä¸»é¡µé¢
- `public/css/main.css` - æ ·å¼æ–‡ä»¶
- `public/js/` - JavaScript é€»è¾‘

### åç«¯ (Backend)
**ä½ç½®**ï¼š`src/` ç›®å½•
- **Express.js** æ¡†æ¶
- **TypeScript** è¯­è¨€

**å…³é”®ç»„ä»¶ï¼š**
- `src/routes/` - API è·¯ç”±å±‚
- `src/middleware/` - ä¸­é—´ä»¶å±‚

### è„šæœ¬å·¥å…· (Scripts & Tools)
**ä½ç½®**ï¼š`scripts/` å’Œ `src/scripts/`
- **æ•°æ®åº“ç´¢å¼•åˆ›å»º**ï¼š`src/scripts/createDatabaseIndexes.ts`
- **ç”¨æˆ·è®¾ç½®**ï¼š`src/scripts/setupUser.ts`

### å·¥å…·é“¾ (Toolchain)
- **ESLint**ï¼šä»£ç æ£€æŸ¥
- **Prettier**ï¼šä»£ç æ ¼å¼åŒ–
- **Jest**ï¼šæµ‹è¯•æ¡†æ¶

## ğŸ“Š æŠ€æœ¯æ ˆæ¦‚è§ˆ

| æŠ€æœ¯é¢†åŸŸ | æŠ€æœ¯é€‰å‹ |
|----------|----------|
| **åç«¯æ¡†æ¶** | Express.js + TypeScript |
| **æ•°æ®åº“** | MongoDB (å¤šç§Ÿæˆ·æ¨¡å¼) |
| **å‰ç«¯æŠ€æœ¯** | HTML + CSS + JavaScript |
| **æµ‹è¯•æ¡†æ¶** | Jest |
| **å®¹å™¨åŒ–** | Docker + Docker Compose |
| **AI é›†æˆ** | Claude Code CLI + Codex CLI |
| **éƒ¨ç½²æ–¹æ¡ˆ** | Docker Compose + Kubernetes |
| **å¼€å‘å·¥å…·** | ESLint + Prettier |
| **åŒ…ç®¡ç†** | npm |

## ğŸ”§ æ‰©å±•æ€§è®¾è®¡

### æ¨¡å—åŒ–æ¶æ„
- **é«˜å†…èšä½è€¦åˆ**ï¼šå„æ¨¡å—èŒè´£æ¸…æ™°ï¼Œæ¥å£æ˜ç¡®
- **æ’ä»¶åŒ–æ¶æ„**ï¼šæ”¯æŒæ–°çš„ AI æ¨¡å‹é›†æˆ
- **é…ç½®é©±åŠ¨**ï¼šé€šè¿‡ç¯å¢ƒå˜é‡é…ç½®ç³»ç»Ÿè¡Œä¸º

### é…ç½®ç³»ç»Ÿ
- **ç¯å¢ƒå˜é‡é…ç½®**ï¼šæ”¯æŒçµæ´»çš„é…ç½®ç®¡ç†
- **å¤šç§Ÿæˆ·æ”¯æŒ**ï¼šä¼ä¸šçº§æ•°æ®éš”ç¦»
- **API æ‰©å±•**ï¼šRESTful API è®¾è®¡
